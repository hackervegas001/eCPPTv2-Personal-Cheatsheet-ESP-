
SSH Session Hijacking, es uno de los métodos que podemos explorar para movimiento lateral. [SSH Hijacking Mitre](https://attack.mitre.org/wiki/Technique/T1184)

[Mitre ATT&CK Framework](https://attack.mitre.org/wiki/Main_Page)

*Para poder aprovechar éste método, la máquina comprometida debe tener una sesión SSH activa establecidad a otra máquina **(via public key authentication)*

Si somos root en el sistema comprometido, entonces es posible comprometer el agente SSH o acceder al [unix domain socket del agente SSH](https://en.wikipedia.org/wiki/Unix_domain_socket) y robar la conexión.

La razón por la que ésto es posible es que el agente SSH crea un Unix domain socket, y después se pone a la escucha de conexiones desde el demonio *sshd* hasta éste socket.

La protección del socket recae sobre simples permisos unix, lo cual últimamente significa que las claves de autenticación que son usadas con ese socket pueden ser accedidas por cualquier usuario que pueda conectarse al socket en cuestión.

*Ejemplo de los pasos que debemos hacer para ejecutar el ataque*

1º Determinamos el PID (process ID) del servicio SSH del usuario en el host comprometido:

```
ps aux | grep sshd
```

2º Determinamos la variable de entorno SSH_AUTH_SOCK para el PID sshd:

```
grep SSH_AUTH_SOCK /proc/PID/environ
```

3º Robamos el socket del agente-ssh del objetivo:

```
SSH_AUTH_SOCK=/tmp/ssh-XXXXXXX/agent.XXXX ssh-add -l
```

4º Finalmente, iniciamos sesión en el sistema remoto en el que nuestra víctima ha iniciado sesión como el objetivo:

```
ssh remotesystem -l victim
```

[Para más info acerca de éste método](https://xorl.wordpress.com/2018/02/04/ssh-hijacking-for-lateral-movement/)

