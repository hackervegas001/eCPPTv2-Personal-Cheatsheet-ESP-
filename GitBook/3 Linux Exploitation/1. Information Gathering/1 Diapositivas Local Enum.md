
Una vez obtenemos acceso a una víctima Linux (ya sea como un user sin privilegios o con privilegios, via shell o via web app con inyección remota de comandos).

El tipo de información que recopilamos en esta fase cae en dos grandes categorías:

Información de la red, e información del sistema.

- **Información de la red*

*-Con el siguiente comando sacamos toda la lista de las interfaces existentes.

```
ifconfig -a
```

*-Con el siguiente comando sacamos las rutas en la red, las cuales incluyen la puerta de enlace.

Esta información puede ser de ayuda en caso de que necesitamos configurar manualmente las interfaces de red, pivotar a otros segmentos de red, o será de ayuda si queremos realizar ataques Man in the Middle como ARP-poisoning.

```
route -n
```

*-Con el siguiente comando podemos ver cuantos saltos hay entre nuestra máquina comprometida y otros segmentos de red:

```
traceroute -n IPobj
```

*-La información DNS* está alojada en el archivo /etc/resolv.conf

```
cat /etc/resolv.conf
```

*-Caché ARP

La caché ARP puede darnos información de otras máquinas conectadas a nuestra máquina explotada. Ésta info. es útil para determinar con quién se comunica la máquina atacante, qué es lo que está siendo comunicado, si se transmiten credenciales en texto plano por algún protocolo que no esté encriptado, etc...

```
arp -en
```

*-Netstat

Netstat nos proporciona información acerca de con qué otras máquinas estamos conectados, a qué puertos o servicios de otras máquinas estamos conectados, qué puertos tiene nuestra máquina actual en escucha, y si otros sistemas establecen conexiones con nuestra máquina explotada.

Podemos listar todas las conexiones TCP y UDP a otros sistemas y puertos y servicios en escucha con:

```
netstat -auntp
```

En caso de que netstat no exista podemos enumerar info. similar desde los archivos /proc/net/tcp y /proc/net/udp

```
cat /proc/net/tcp
cat /proc/net/udp
```

Otra alternativa para netstat es *ss*

Mediante ss podemos listar las conexiones activas en red.

Con ss -twurp podemos enumerar conexiones establecidas, bytes siendo transferidos, y los usuarios/procesos responsables de las conexiones.

```
ss -twurp
```

*-Outbound Port Connectivity (reglas firewall salientes)*

Otra cosa que queremos verificar es si la conexión saliente de puertos está restringida de alguna forma.

Ésta información es útil cuando queremos establecer conexiones salientes a otros sistemas que controlamos con el propósito de mantener acceso o exfiltrar datos.

Una forma rápida de comprobar que tenemos conexión saliente es:

```
nmap -sT -p- porquiz.net
```

En un pentesting real hay que tener en cuenta que ésto puede saltar las alarmas del IDS si no tenemos el parámetro -T a un nivel bajo como 0,1,2.

*SUMARIO*

```
cat /etc/resolv.conf # DNS server
ifconfig -a # Listar info de las interfaces de red actuales
route # listar info de la ruta actual de la red
traceroute -n IPaddress # seguir el camino de un paquete a través de segmentos de red
arp -a # ver la caché arp
netstat -auntp # conexiones/puertos TCP y UDP establecidos y en escucha
ss -twurp #listar conexiones activas, procesos, users y bytes
```

- **SYSTEM INFORMATION GATHERING**

Se parece a la fase de Network info. gathering, excepto porque recibimos muchos más datos. Nuestra meta en esta fase es conseguir información acerca de:

OS y kernel; variables de entorno; archivos interesantes e información sensible; usuarios, grupos, permisos y privilegios; servicios y archivos de configuración asociados; cron jobs y tareas del sistema; aplicaciones instaladas y sus versiones; procesos corriendo.

[GTFObins Privesc, etc](https://gtfobins.github.io/)

```
id # info user actual
uname -a # version kernel
cat /etc/passwd | grep sh # current user info de /etc/passwd
lastlog # logins recientes
w # quien esta logeado actualmente
last # ultimos logeados
for user in $(cat /etc/passwd | cut -f1 -d":"); do id $user; done # todos los users incluyendo UID y GID info
```


```
cat /etc/passwd | cut -f1,3,4 - d":" | grep "0:0" | cut -f1 -d ":" | awk '(print $1)'    #listar todas las cuentas root

cat /etc/passwd    #listar users y cuentas de servicios.

cat /etc/shadow      #con privilegios

sudo -l     #¿que podemos hacer como sudo sin dar contraseña?

cat /etc/sudoers   #para ver si podemos leer el archivo sudoers y comprobar quienes pueden hacer sudo en el sistema

cat /root/.bash_history    #para comprobar si podemos leer el historial de bash del usuario root

find /home/* -name *.*history* -print 2> /dev/null  # buscar archivos .history en todas las carpetas home

cat /etc/issue     #info del OS
cat/etc/*-release   #info del OS
```

```
#¿podemos hacer sudo a binarios que permitan ejecutar una shell?

sudo -l | grep vim
sudo -l | grep nmap
sudo -l | grep vi

ls -als /root/ #¿podemos listar el directorio home de root?

echo $PATH #variable de entorno actual del PATH

cat /etc/crontab && ls -als /etc/cron*  #listar todos los cron jobs

find /etc/cron* -type f -perm -o+w -exec ls -l {} \;  #encontrar cron jobs con permisos de escritura

ps auxwww  #listar procesos activos

ps -u root  #listar todos los procesos que se lanzan como root

ps -u $USER  #listar todos los procesos del user actual
```

```
find / -perm -4000 -type f 2_/dev/null  #buscar archivos SUID

find / -uid 0 -perm -4000 -type f 2>/dev/null  #buscar archivos SUID pertenecientes a root

find / -perm -2000 -type -f 2>/dev/null  #buscar archivos GUID

find -perm -2 -type f 2>/dev/null  #buscar archivos con permisos de escritura

ls -al /etc/*.conf  #listar todos los archivos de configuracion de /etc

grep pass* /etc/*.conf  #buscar archivos de configuración que contengan la string "pass"

lsof -n  #listar archivos abiertos
```

```
dpkg -l  #listar paquetes instalados (debian)

#listar versiones de programas comunes

sudo -V
httpd -v
apache2 -v
mysql -V
sendmail -d0.1

#imprimir binarios/rutas de procesos y sus permisos
ps aux | awk `(print $11)´ | xargs -r ls -la 2>/dev/null | awk `!x[$0]++´

```

**-HERRAMIENTAS AUTOMATIZADAS LOCAL ENUM*

[LinEnum](https://github.com/rebootuser/LinEnum)

Muy útil ya que cubre lo mencionado anteriormente y de muchas más formas.

[LinuxPrivChecker](https://github.com/sleventyeleven/linuxprivchecker)

LinuxPrivChecker comprueba métodos disponibles de escalada de privilegios.

[Unix-Privesc-Check](https://pentestmonkey.net/tools/audit/unix-privesc-check)

Lo mismo con Unix-Privesc-Check

[Mimipenguin](https://github.com/huntergregal/mimipenguin)

Dumpea las credenciales de logeo del usuario actual, servicios, etc...

[Hacktricks Tutoriales de todo](https://book.hacktricks.xyz/linux-hardening/linux-privilege-escalation-checklist)

[GTFObins binarios para privesc](https://gtfobins.github.io/)

